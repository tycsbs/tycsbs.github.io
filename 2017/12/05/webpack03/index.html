<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Webpack3.0小案例躺坑静态资源处理的那些事 | 白松的博客</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Webpack3.0小案例躺坑静态资源处理的那些事</h1><a id="logo" href="/.">白松的博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Webpack3.0小案例躺坑静态资源处理的那些事</h1><div class="post-meta"><a href="/2017/12/05/webpack03/#comments" class="comment-count"><i data-thread-key="2017/12/05/webpack03/" class="ds-thread-count"></i>留言</a><p><span class="date">2017-12-05</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>webpack3.0小案例系列，抛砖引玉，希望大家多提意见，一起学习：</p>
<p><a href="https://juejin.im/post/5a1bc292f265da432d27d146" target="_blank" rel="noopener">webpack3.0小案例webpack初体验</a></p>
<p><a href="https://juejin.im/post/5a1e9fe66fb9a044fe4620be" target="_blank" rel="noopener">Webpack3.0小案例躺坑css处理与ES6编译</a></p>
<hr>
<p>前两节文章我们手把手搭建了一个基于webpack的前端开发工程环境，并讲解了一些常用插件及loader的基本用法，包括代码分割、模板读取、文件清理、ES6编译及css处理等等，这篇文章我继续在前两篇的基础上，继续探讨：</p>
<ul>
<li><strong>图片处理</strong> ， 包括file-loader、url-loader、image-webpack-loader的用法，file-loader和url-loader的区别等。</li>
<li><strong>服务端启动webpack-dev-server</strong> ，包括手动搭建测试服务端以及运用webpack建立webpackServer和一些注意事项等。</li>
<li><strong>webpack打包优化</strong> ，包括代码压缩，公共代码提取等配置。</li>
</ul>
<hr>
<h2 id="image图片处理"><a href="#image图片处理" class="headerlink" title="image图片处理"></a>image图片处理</h2><p>webpack对图片的处理常用的有url-loader、file-loader、image-webpack-loader，各个加载器都在打包过程中有着自己的功能职责，在探讨他们的使用方法之前，老规矩，我们先弄明白他们各自都做了什么。</p>
<ul>
<li><strong>file-loader</strong> ， 将项目中定义加载的图片通过webpack编译打包，并返回一个编码后的公共的url路径。</li>
<li><strong>url-loader</strong> ，url-loader作用和file-loader的作用基本是一致的，不同点是url-loader可以通过配置一个limit值来决定图片是要像file-loader一样返回一个公共的url路径，或者直接把图片进行base64编码，写入到对应的路径中去。</li>
<li><strong>image-webpack-loader</strong> ，用来对编译过后的文件进行压缩处理，在不损失图片质量的情况下减小图片的体积大小。</li>
</ul>
<hr>
<h3 id="file-loader"><a href="#file-loader" class="headerlink" title="file-loader"></a>file-loader</h3><p>1、首先，我们在src目录下新建assets文件夹用来放置所有的静态资源，在该目录下我们放入两张图片<em>bg_webpack-sm.jpg</em> 和 <em>bg_webpack-lg.jpg</em>，大小分别是6kb和12kb（之所以放两张不同大小的图片是用于体验url-loader的limit参数的作用）。</p>
<p><img src="/2017/12/05/webpack03/wp03_7.jpg" alt="assets"></p>
<p>2、打开style.less文件，新增一个container的css类，并在index.html中添加一个类名为container的div</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'../assets/bg_webpack-lg.jpg'</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、 命令行定位到根目录下，安装file-loader，并在webpack配置文件中新增一条处理规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install file-loader --save-dev</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">          ...</span><br><span class="line">          &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpg|gif|svg)$/</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            use: [&#123;</span><br><span class="line">                loader: <span class="string">'file-loader'</span>,</span><br><span class="line">                options: &#123;&#125;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>再次执行webpack命令进行编译，我们发下在dist目录下已经打包出了我们引用的图片资源</p>
<p><img src="/2017/12/05/webpack03/wp03_1.jpg" alt="file-loader打包"></p>
<hr>
<h3 id="file-loader配置"><a href="#file-loader配置" class="headerlink" title="file-loader配置"></a>file-loader配置</h3><p>现在，图片文件已经打包成功了，但是我们发现两个问题：</p>
<ul>
<li>打开dist文件夹下面的index.html，发现图片并没有在界面中显示出来。</li>
<li>打包后的图片直接生成在了dist目录下，而我们想要他生成的指定文件夹下面，这显然和我们的期望是不符合的。</li>
</ul>
<p><img src="/2017/12/05/webpack03/wp03_4.jpg" alt="file-loader打包"></p>
<p>别着急，为了解决这两个问题，我们需要先对file-loader的部分配置项参数作用有一个大致的了解：</p>
<ul>
<li><p><strong>name</strong> ，指定打包生成后资源文件的name值，file-loader给我们指定了一些占位符来自定义name，我们可以自己任意搭配占位符来得到我们想要生成的文件名称的格式，默认情况下是：[hash].[ext]</p>
<p> | 名称    |   描述  |<br> | —-   |:—      |<br> | [ext]  | 文件的后缀名，默认是原始资源的后缀名 |<br> | [name] | 文件名称，也就是原始资源的名称  |<br> | [path] | 文件存放的路径  |<br> | [hash] | hash值，默认是md5  |<br> | [N]    | 数字  |</p>
</li>
<li><p><strong>publicPath</strong> ，用来指定打包生成后的css或者url引用中路径的配置，也就是说<strong>pulicPath针对的是路径，并不是文件本身。</strong></p>
</li>
<li><strong>outputPath</strong>，用来配置打包生成的文件输出的位置，它针对的是文件存储的位置，和代码中的路径引用无关。</li>
<li><strong>useRelativePath</strong>， 配置打包生成后的路径是否为相对位置，默认情况下是false。需要注意的是，<strong>开启useRelativePath后，outputPath的设置会以src目录中的assets文件夹为准，设置其他的名称不会生效</strong>。</li>
<li><strong>emitFile</strong> ，配置对打包的资源文件是否需要进行发布，默认为true。</li>
</ul>
<p>从这些配置项中，我们大致可以找到以上两个问题的原因：</p>
<ul>
<li>1、图片生成位置不对是因为我们没指定outputPath，默认读取了出口（output）的值；</li>
<li>2、在浏览器中打开但没有显示出图片，是由于未设定publicPath的值，因此在生成的css的background的url中会自动默认到与css文件同一级里面，导致url地址不对，因此找不到图片资源。</li>
</ul>
<p>因此针对这两个问题，我们对配置文件进行配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">          ...</span><br><span class="line">          &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpg|gif|svg)$/</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            use: [&#123;</span><br><span class="line">                loader: <span class="string">'file-loader'</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">'[hash].[ext]'</span>,</span><br><span class="line">                    outputPath: <span class="string">'/assets/'</span>,<span class="comment">//定义图片输出存放的文件夹位置</span></span><br><span class="line">                    useRelativePath: <span class="literal">true</span>,<span class="comment">//设置路径为相对位置</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>在配置项中，我们定义了文件输出的名称以hash值来命名，并指定文件输出到dist下的assets文件夹下，然后开启路径为相对路径，再次执行webpack编译，发现文件已经按照设定生成到assets目录下了。</p>
<p><img src="/2017/12/05/webpack03/wp03_2.jpg" alt="file-loader打包"></p>
<p>打开dist下的index.html，图片成功加载</p>
<p><img src="/2017/12/05/webpack03/wp03_3.jpg" alt="file-loader打包"></p>
<p>当然，在设置file-loader的option的时候，由于paublicPath会去读取webpack出口中的publicPath的值，因此他们之间是有这联系的，出口中设定的publicPath不一样就会导致file-loader中设定的要跟着改变，这一点要把握好。</p>
<hr>
<h3 id="url-loader"><a href="#url-loader" class="headerlink" title="url-loader"></a>url-loader</h3><p>前面我们说过，url-loader是对file-loader的封装，因此，使用url-loader和file-loader方法基本一样，在这里，我们就探讨一下他们不同的地方，也就是limit参数。</p>
<p>1、首先，我们安装好url-loader，并将之前的file-loader替换成url-loader,并在index.html页面中新增类名为container-sm的div元素。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install url-loader --save-dev</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"> <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">          ...</span><br><span class="line">         &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpg|gif|svg)$/i</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            use: [&#123;</span><br><span class="line">                loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">10240</span>,</span><br><span class="line">                    outputPath: <span class="string">'assets/'</span>,</span><br><span class="line">                    useRelativePath: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>配置项中，我们指定图片大于10kb的图片进行文件加载，小于10kb的文件则直接转换出base64编码直接写入到css中，这样我们刚刚放入的两张图片结果应该是大的一张以图片资源的方式加载，而小的一张则直接被编码成base64后写入到css文件中。最后效果如下：</p>
<p><img src="/2017/12/05/webpack03/wp03_5.jpg" alt="url-loader打包"></p>
<p>可以发现结果和我们预计的一样，表示url-loader已经生效。url-loader对我们处理小型图片很有帮助，他可以有效减小访问服务端的次数，减小访问时间，特别是针对一些icon图标的时候很有效果。</p>
<blockquote>
<p><strong>使用url-loader的时候，我们需要对limit大小界限值进行权衡；base64编码可以减少浏览器的访问次数，但是它的不足是编码特别长，这样很容易导致代码体积变大。而通过路径的方式可以减少代码的体积量，并且浏览器在多次访问的时候也会对文件进行缓存处理，但毕竟会增加对服务器资源的访问次数。因此，如何设置limit的大小，需要根据项目的情况来定</strong></p>
</blockquote>
<hr>
<h3 id="image-webpack-loader-图片压缩"><a href="#image-webpack-loader-图片压缩" class="headerlink" title="image-webpack-loader 图片压缩"></a>image-webpack-loader 图片压缩</h3><p>由于url-loader在对文件处理的时候会增大文件的体积，比如对文件进行base64编码，就会使文件的体积比原版体积更大，因此，image-webpack-loader就应运而生，它的作用就是在进行url-loader处理之前，首先对静态资源进行压缩处理，处理过后的图片资源再决定是否用base64编码。</p>
<p>1、首先我们对image-webpack-loader进行安装，然后再webpack配置中进行对配置的修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install image-webpack-loader --save-dev</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">...</span><br><span class="line"> <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">          ...</span><br><span class="line">         &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpg|gif|svg)$/i</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            use: [&#123;</span><br><span class="line">                loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">10240</span>,</span><br><span class="line">                    outputPath: <span class="string">'assets/'</span>,</span><br><span class="line">                    useRelativePath: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                loader: <span class="string">'image-webpack-loader'</span>,<span class="comment">//新增image-webpack-loader</span></span><br><span class="line">                options: &#123;</span><br><span class="line">                    mozjpeg: &#123;<span class="comment">//设置对jpg格式的图片压缩的程度设置</span></span><br><span class="line">                        progressive: <span class="literal">true</span>,</span><br><span class="line">                        quality: <span class="number">65</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>在配置项中，我们对图片进行压缩处理，并设置对jpg类型的图片压缩到65%质量值，最后运行webpack命令，发现两张图片都被压缩成4.75kb大小的图片，在css中，两张图片都已经以base64编码的方式呈现了。</p>
<p><img src="/2017/12/05/webpack03/wp03_6.jpg" alt="image压缩"></p>
<p>image-webpack-loader对不同类型的图片都对应有不同的处理配置设定，针对不同的图片开发者可以自定义压缩比例。</p>
<ul>
<li><strong>gifsicle — 压缩gif图片格式</strong></li>
<li><strong>mozjpeg — 压缩JPEG图片格式</strong></li>
<li><strong>optipng — 压缩PNG图片格式</strong></li>
<li><strong>pngquant — 压缩PNG图片格式</strong></li>
<li><strong>webp — 压缩PNG和JPEG图片成webp格式</strong></li>
<li><strong>svgo — 压缩SVG图片格式</strong></li>
</ul>
<hr>
<h2 id="服务端运行设置"><a href="#服务端运行设置" class="headerlink" title="服务端运行设置"></a>服务端运行设置</h2><p>到目前为止，我们的小案例已经把常用的基本的loader梳理了一遍，但是我们又发现了一些问题，比如每次更改代码后都需要进行webpack重新编译，并且，我们的文件还是以文件系统的方式在浏览器中打开的，这个似乎不是webpack给我们提供的编码姿势，因此，接下来，我们将考虑如何让我们的项目在服务器上跑起来等一系列问题。</p>
<h3 id="DIY一个临时服务器"><a href="#DIY一个临时服务器" class="headerlink" title="DIY一个临时服务器"></a>DIY一个临时服务器</h3><p>既然我们指定了webpack最终打包后的文件在dist目录下，那么现在我们只要将dist内的文件在服务器端跑起来不就可以了吗，这似乎可行的，那么我就先来尝试一下</p>
<p>1、在根目录下，新建一个server.js的文件，并安装express</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install express --save-dev</span><br></pre></td></tr></table></figure>
<p>2、在server.js内，我们利用express来写一个简单的服务器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = process.env.port || <span class="number">3000</span>;</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'dist'</span>)));<span class="comment">//设置可访问的静态资源目录</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        req.url = <span class="string">'index.html'</span>;</span><br><span class="line">        next()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`server is running at <span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3、打开package.json，在script配置项下新增如下命令：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//package.json</span><br><span class="line">...</span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "server": "node server.js",//设置用node运行server.js</span><br><span class="line">    "build": "webpack"//设置webpack编译命令</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这样我们就可以在控制台通过cnpm来运行项目了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cnpm run build /*执行webpack打包命令*/</span><br><span class="line"></span><br><span class="line">cnpm run server /*让编译后的文件通过服务器加载*/</span><br></pre></td></tr></table></figure>
<p>执行完以上命令后，在浏览器中输入：localhost:3000，即可访问最终打包的文件了，但是，我们要的热更新依然没有，而且还是需要每次都打包，除了用服务器跑起来似乎并没有解决我们的问题（黑人郁闷脸）。</p>
<hr>
<h3 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h3><p>其实解决在开发中的这个实时编译问题，webpack早已为我们提供了简便的方法。</p>
<p>webpack-dev-server是一个小型的nodejs express服务器，支持两种模式来自动刷新页面，并且都提供热更新，我们的实践是以inline模式为例的</p>
<ul>
<li>iframe模式，页面放在iframe中,当发生改变时重载</li>
<li>inline模式，将webpack-dev-sever的客户端入口添加到包(bundle)中</li>
</ul>
<p>热更新的好处是只替换更新的部分,而不需要去页面重载。</p>
<p>1、安装webpack-dev-server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure>
<p>2、安装完成后，我们打开package.json文件，在script配置项下新增：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//package.json</span><br><span class="line">...</span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "server": "node server.js",//设置用node运行server.js</span><br><span class="line">    "build": "webpack",//设置webpack编译命令</span><br><span class="line">    "dev": "webpack-dev-server"</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>这样，我们只要在命令行输入 “cnpm run dev ”既可以把项目运行起来。</p>
<p>3、 用webpack-dev-server运行的时候，默认端口是8080，因此，我们在运行webpack-dev-server后，在浏览器执行 localhost:8080，即可访问项目，这个时候因为项目是处于开发环境，文件只是存储在内存中而并没有真正打包出来，因此，项目中并不会生成dist文件夹，也正因如此，我们动态改变代码的时候，webpack就会自动更新到界面上去。</p>
<p>webpack在配置项中也为我们提供了配置webpack-dev-server的节点，也就是devServer配置项，在这个配置项中，我们可以更改启动的端口号，加载模式（iframe或者inline）等等，但需要注意的是<strong>webpack3.0已经默认热更新，如果在devServer中再次设定hot属性的时候，热更新反而会失效</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">entry: path.resolve(__dirname, <span class="string">'./src/main.js'</span>),</span><br><span class="line">output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    filename: <span class="string">'js/[name]-[chunkhash].js'</span></span><br><span class="line">&#125;,</span><br><span class="line">devServer: &#123;</span><br><span class="line">    <span class="comment">// hot: true, 不要设置hot热更新属性，设定后反而会失效</span></span><br><span class="line">    port: <span class="number">3000</span>,</span><br><span class="line">    inline: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="webpack打包优化"><a href="#webpack打包优化" class="headerlink" title="webpack打包优化"></a>webpack打包优化</h2><p>webpack优化是一个很有技术性的话题，展开来说的话估计又是一个比较长的话题，我们这一节里先针对我们目前的项目结构罗列几项，抛砖引玉。</p>
<h3 id="代码压缩-UglifyJsPlugin"><a href="#代码压缩-UglifyJsPlugin" class="headerlink" title="代码压缩 UglifyJsPlugin"></a>代码压缩 UglifyJsPlugin</h3><p>UglifyJsPlugin是webpack默认提供的代码压缩优化器，当在配置项中使用了这个插件之后，打包后的js文件会进行代码压缩和注释删除等压缩手段，这个在项目build的时候，会减小打包后项目的体积。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    plugins: [</span><br><span class="line">       <span class="comment">//启用js压缩</span></span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">            compress: &#123;</span><br><span class="line">                warnings: <span class="literal">false</span>,</span><br><span class="line">                drop_console: <span class="literal">false</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> cleanWebpackPlugin(</span><br><span class="line">            [<span class="string">'dist'</span>], &#123;</span><br><span class="line">                verbose: <span class="literal">false</span>,</span><br><span class="line">                dry: <span class="literal">false</span>,</span><br><span class="line">                root: __dirname</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    ]</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="减小范围-include-amp-amp-exclude"><a href="#减小范围-include-amp-amp-exclude" class="headerlink" title="减小范围 include &amp;&amp; exclude"></a>减小范围 include &amp;&amp; exclude</h3><p>webpack的loader加载器设置中，每一个loader都允许对处理文件进行指定，包括哪一个或者不包括哪一个文件夹内的文件，这样会很大程度上减小扫描的范围，减小打包时间。实际上，在我们的项目中我们已经设定了exclude参数，以排除loader对node_modules中文件的扫描。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    use: [&#123; <span class="attr">loader</span>: <span class="string">"babel-loader"</span> &#125;],</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    include: <span class="regexp">/src/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="公共代码提取-CommonsChunkPlugin"><a href="#公共代码提取-CommonsChunkPlugin" class="headerlink" title="公共代码提取 CommonsChunkPlugin"></a>公共代码提取 CommonsChunkPlugin</h3><p>webpack默认提供的CommonsChunkPlugin插件可以将代码中公用的模块提取出来，比如常用的类似jquery、moment这样的额第三方插件，如果在每个引用的js打包文件中都进行打包，最终的项目体积就会成倍增加，通过使用CommonsChunkPlugin可以将这些公用部分提取，有效减小项目体积。</p>
<h3 id="设置-babel-的-cacheDirectory-为true"><a href="#设置-babel-的-cacheDirectory-为true" class="headerlink" title="设置 babel 的 cacheDirectory 为true"></a>设置 babel 的 cacheDirectory 为true</h3><p>babel编译是一个比较费时间的过程，对babel处理的设置，我们不仅要设置include &amp;&amp; exclude来尽可能准确定位编译的文件，还可以充分利用缓存来进一步提升速度，设置babel的cacheDirectory为true，是一个很好的优化方式。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    use: [&#123; <span class="attr">loader</span>: <span class="string">"babel-loader"</span> ,<span class="attr">cacheDirectory</span>: <span class="literal">true</span>&#125;],</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    include: <span class="regexp">/src/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>这一节我们从webpack对静态资源相关的处理以及服务器加载和webpack打包优化等做了总结，其实好多依然讲的不全，很多地方也没有做详细的解释，但千里之行始于足下，一步一步来，我相信你终究会得到你想要的。</p>
<p><strong>还是不忘说一句，愿各位早日成为一名合格的前端高手，加油！</strong></p>
</div><div class="tags"><a href="/tags/webpack/">webpack</a><a href="/tags/前端/">前端</a><a href="/tags/nodejs/">nodejs</a></div><div class="post-share"></div><div class="post-nav"><a href="/2017/11/29/webpack02/" class="next">Webpack3.0快速入门之css处理与ES6编译</a></div><div id="comments"><div data-thread-key="2017/12/05/webpack03/" data-title="Webpack3.0小案例躺坑静态资源处理的那些事" data-url="http://tycsbs.github.io/2017/12/05/webpack03/" data-author-key="1" class="ds-thread"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#image图片处理"><span class="toc-text">image图片处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file-loader"><span class="toc-text">file-loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-loader配置"><span class="toc-text">file-loader配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#url-loader"><span class="toc-text">url-loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#image-webpack-loader-图片压缩"><span class="toc-text">image-webpack-loader 图片压缩</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务端运行设置"><span class="toc-text">服务端运行设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DIY一个临时服务器"><span class="toc-text">DIY一个临时服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack-dev-server"><span class="toc-text">webpack-dev-server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack打包优化"><span class="toc-text">webpack打包优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码压缩-UglifyJsPlugin"><span class="toc-text">代码压缩 UglifyJsPlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#减小范围-include-amp-amp-exclude"><span class="toc-text">减小范围 include && exclude</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#公共代码提取-CommonsChunkPlugin"><span class="toc-text">公共代码提取 CommonsChunkPlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置-babel-的-cacheDirectory-为true"><span class="toc-text">设置 babel 的 cacheDirectory 为true</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后"><span class="toc-text">最后</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/05/webpack03/">Webpack3.0小案例躺坑静态资源处理的那些事</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/29/webpack02/">Webpack3.0快速入门之css处理与ES6编译</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/webpack01/">Webpack3.0快速入门（一）--初体验</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.zhangxinxu.com/" title="张鑫旭博客" target="_blank">张鑫旭博客</a><ul></ul><a href="http://www.ruanyifeng.com/blog/" title="阮一峰博客" target="_blank">阮一峰博客</a><ul></ul><a href="http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html" title="Tom大叔" target="_blank">Tom大叔</a><ul></ul><a href="http://taobaofed.org/" title="阿里爸爸淘宝FE" target="_blank">阿里爸爸淘宝FE</a><ul></ul><a href="http://es6.ruanyifeng.com/#docs/class" title="ES6入门到放弃" target="_blank">ES6入门到放弃</a><ul></ul><a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/" title="廖雪峰博客" target="_blank">廖雪峰博客</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">白松.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>var duoshuoQuery = {short_name:'tycsbs'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    document.getElementsByTagName('body')[0].appendChild(ds);
})();
</script></body></html>